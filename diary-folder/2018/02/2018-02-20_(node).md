 # node

node 内存回收, v8 将内存分为新生代与老生代, 新生代存活时间比较短, 老生代存活时间比较长, 所以在不同的生代采用不同的回收算法.
新生代中采用停止复制算法, 将新生代分为两个半区域, from 与 to:
```
1. 将 from 空间的活对象复制到 to 空间
2. 切换 from 与 to
```
也就是将活的对象复制到另一个空间, 然后切换两个空间的角色.
因为老生代的对象存活时间比较多并且空间比较大, 老生代是利用标记清除算法, 并使用标记压缩整理内存碎片:
```
1. 对老生代进行一次扫描, 标记存活对象
2. 对老生代进行二次扫描, 清除未被标记对象
3. 将存活对象往内存一端移动
4. 清除存活对象边界外的内存
```
新生代因为空间小, 对象少, stop-the-world 对性能也不会影响很多, 但是老生代内存大, 对象多, 1,2,3,4 都需要停止应用逻辑, 所以引入增量标记, 使得应用逻辑与垃圾回收交替进行.